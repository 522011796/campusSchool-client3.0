{"version":3,"file":"pages/app/appServerForm.js","sources":["webpack:///./pages/app/appServerForm.vue?b952","webpack:///./pages/app/appServerForm.vue?fd36","webpack:///./pages/app/appServerForm.vue?66b4","webpack:///./pages/app/appServerForm.vue?0d16","webpack:///./pages/app/appServerForm.vue","webpack:///./pages/app/appServerForm.vue?6634","webpack:///./pages/app/appServerForm.vue?c1f4"],"sourcesContent":["// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../node_modules/css-loader/dist/cjs.js??ref--3-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--3-oneOf-1-2!../../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./appServerForm.vue?vue&type=style&index=0&id=5e846832&scoped=true&lang=css&\");\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add CSS to SSR context\nvar add = require(\"!../../node_modules/vue-style-loader/lib/addStylesServer.js\").default\nmodule.exports.__inject__ = function (context) {\n  add(\"548b4fae\", content, true, context)\n};","import mod from \"-!../../node_modules/vue-style-loader/index.js??ref--3-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--3-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--3-oneOf-1-2!../../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./appServerForm.vue?vue&type=style&index=0&id=5e846832&scoped=true&lang=css&\"; export default mod; export * from \"-!../../node_modules/vue-style-loader/index.js??ref--3-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--3-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--3-oneOf-1-2!../../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./appServerForm.vue?vue&type=style&index=0&id=5e846832&scoped=true&lang=css&\"","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".header-title-block[data-v-5e846832]{height:60px;line-height:60px;width:100%}.content-block[data-v-5e846832]{border-top-left-radius:10px;border-top-right-radius:10px;border-bottom-left-radius:10px;border-bottom-right-radius:10px;background:#fff}.title-block-tag[data-v-5e846832]{display:inline-block;height:20px;width:3px;background:#e6a23c;font-weight:700;border-radius:3px}.title-block-text[data-v-5e846832]{font-weight:700;position:relative;top:-5px}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_vm._ssrNode(\"<div\"+(_vm._ssrClass(null,_vm.loginUserAppType == 4 ? 'bg-app-success_teacher' : 'bg-app-success'))+(_vm._ssrStyle(null,{height: _vm.navHeight+'px'}, null))+\" data-v-5e846832></div> \"),_vm._ssrNode(\"<div\"+(_vm._ssrClass(\"header-title-block color-white\",_vm.loginUserAppType == 4 ? 'bg-app-success_teacher' : 'bg-app-success'))+\" data-v-5e846832>\",\"</div>\",[_c('van-row',[_c('van-col',{attrs:{\"span\":\"6\"}},[_c('div',{staticClass:\"text-left padding-lr-10\"},[_c('span',{staticClass:\"font-bold font-size-14\",on:{\"click\":_vm.returnBlock}},[_c('i',{staticClass:\"fa fa-chevron-left\"}),_vm._v(\"\\n            \"+_vm._s(_vm.$t(\"返回\"))+\"\\n          \")])])]),_vm._v(\" \"),_c('van-col',{attrs:{\"span\":\"18\"}},[_c('div',{staticClass:\"text-right padding-lr-10\"},[(_vm.customUserStatus == true)?[_c('el-select',{staticStyle:{\"width\":\"130px\"},attrs:{\"size\":\"small\",\"multiple\":\"\",\"collapse-tags\":\"\",\"placeholder\":\"请选择审批人\"},model:{value:(_vm.auditSelUser),callback:function ($$v) {_vm.auditSelUser=$$v},expression:\"auditSelUser\"}},_vm._l((_vm.auditUsers),function(item){return _c('el-option',{key:item.value,attrs:{\"label\":item.label,\"value\":item.value}})}),1)]:_vm._e(),_vm._v(\" \"),_c('span',{staticStyle:{\"position\":\"relative\",\"top\":\"-5px\"}},[(_vm.fromCreateBtnShow == true)?_c('van-button',{attrs:{\"plain\":\"\",\"size\":\"small\",\"type\":\"primary\",\"loading\":_vm.btnLoading},on:{\"click\":function($event){return _vm.serverSubBlock($event)}}},[_c('i',{staticClass:\"fa fa-edit\"}),_vm._v(\"\\n              \"+_vm._s(_vm.fromCreateBtnText)+\"\\n            \")]):_vm._e()],1)],2)])],1)],1),_vm._ssrNode(\" \"),_vm._ssrNode(\"<div style=\\\"margin-top:1px;\\\" data-v-5e846832>\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"content-block padding-tb-10\\\"\"+(_vm._ssrStyle({\"background\":\"#f5f5f5\"},_vm.divHeight7, null))+\" data-v-5e846832>\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"color-muted font-size-12 bg-white padding-lr-10 padding-tb-10\\\" data-v-5e846832><span data-v-5e846832><label class=\\\"title-block-tag\\\" data-v-5e846832></label> <label class=\\\"title-block-text color-warning\\\" data-v-5e846832>\"+_vm._ssrEscape(_vm._s(_vm.$t(\"服务简介\")))+\"</label></span></div> \"),_vm._ssrNode(\"<div class=\\\"bg-white padding-lr-10\\\" style=\\\"padding-bottom: 10px\\\" data-v-5e846832>\",\"</div>\",[_vm._ssrNode(\"<div data-v-5e846832>\",\"</div>\",[(_vm.serverDetail.des && _vm.serverDetail.des != '')?[_vm._ssrNode(((_vm.showCollapse == false)?(\"<div data-v-5e846832><span data-v-5e846832>\"+_vm._ssrEscape(_vm._s(_vm.serverDetailTitle))+\"</span> <span data-v-5e846832><i class=\\\"fa fa-angle-down pull-right\\\" data-v-5e846832></i></span></div>\"):\"<!---->\")+\" \"),_c('el-collapse-transition',[(_vm.showCollapse == true)?_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.showCollapse),expression:\"showCollapse\"}],on:{\"click\":function($event){_vm.showCollapse = false}}},[_vm._v(\"\\n                \"+_vm._s(_vm.serverDetail.des)+\"\\n                \"),_c('span',[_c('i',{staticClass:\"fa fa-angle-up pull-right\"})])]):_vm._e()])]:[_c('van-empty',{staticStyle:{\"padding\":\"0px !important\"},attrs:{\"description\":\"暂无数据\",\"image-size\":\"50\"}})]],2)]),_vm._ssrNode(\" \"),_vm._ssrNode(\"<div class=\\\"margin-top-10 bg-white\\\" data-v-5e846832>\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"color-muted font-size-12 bg-white padding-lr-10 padding-tb-10\\\" data-v-5e846832><span data-v-5e846832><label class=\\\"title-block-tag\\\" data-v-5e846832></label> <label class=\\\"title-block-text color-warning\\\" data-v-5e846832>\"+_vm._ssrEscape(_vm._s(_vm.$t(\"表单内容\")))+\"</label></span></div> \"),_vm._ssrNode(\"<div class=\\\"margin-right-10 margin-left-10\\\" data-v-5e846832>\",\"</div>\",[(_vm.formCreateRuleData != '')?_c('form-create',{attrs:{\"rule\":_vm.formCreateRuleData,\"option\":_vm.formCreateOptionData},model:{value:(_vm.fApi),callback:function ($$v) {_vm.fApi=$$v},expression:\"fApi\"}}):_vm._e()],1)],2)],2)])],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {common} from \"../../utils/api/url\";\nimport { Toast } from 'vant';\n\nimport mixins from \"~/utils/mixins\";\nimport {MessageError, MessageSuccess, MessageWarning} from \"~/utils/utils\";\nexport default {\n  name: 'appServerForm',\n  layout: 'defaultAppScreen',\n  mixins: [mixins],\n  data(){\n    return {\n      rateValue: 0,\n      serverDetailTitle: '',\n      serverDetail: '',\n      fApi: {},\n      formCreateRuleData: [],\n      formCreateOptionData: {},\n      btnLoading: false,\n      customUserStatus: false,\n      fromCreateBtnShow: true,\n      showCollapse: false,\n      fromCreateBtnText: '',\n      auditUsers: [],\n      auditSelUser: [],\n      activeName: '',\n    }\n  },\n  mounted() {\n    this.$nextTick(() => {\n\n    });\n  },\n  created() {\n    this.init();\n  },\n  methods: {\n    layoutInit(){\n\n    },\n    async init(){\n      let list = [];\n      let params = {\n        id: this.$route.query.id\n      };\n      await this.getSessionInfo();\n      this.$axios.get(common.server_form_allInfo, {params: params}).then(res => {\n        if (res.data.code == 200){\n          let auditUser = [];\n          this.serverDetail = res.data.data;\n          this.serverDetailTitle = res.data.data.des ? res.data.data.des.substr(0, 50) + \"...\" : '';\n          let processList = res.data.data.processList;\n          this.customUserStatus = false;\n          this.fromCreateBtnShow = res.data.data.submitButton;\n          this.fromCreateBtnText = res.data.data.buttonName != \"\" ? res.data.data.buttonName : this.$t(\"提交\")\n\n          if (res.data.data.formContent != null && res.data.data.formContent != ''){\n            this.formCreateRuleData = JSON.parse(res.data.data.formContent).rule;\n            this.formCreateOptionData = JSON.parse(res.data.data.formContent).option;\n            this.setFormChildren(this.formCreateRuleData, list, 'children');\n          }\n\n          for (let i = 0; i < processList.length; i++){\n            if (processList[i].htype == 'CustomUser'){\n              let processUser = processList[i].hid;\n              let processUserName = processList[i].hname;\n              for (let j = 0; j < processUser.length; j++){\n                auditUser.push({\n                  label: processUserName[j],\n                  value: processUser[j],\n                  text: processUserName[j]\n                });\n              }\n              this.customUserStatus = true;\n            }\n          }\n          this.auditUsers = auditUser;\n        }\n      });\n    },\n    setFormChildren(array, obj, param){\n      let _self = this;\n      if (array && array.length > 0){\n        array.map(function (item,index) {\n          if(item[param] != undefined && item[param].length > 0){\n            _self.setFormChildren(item[param], obj, param);\n          }else {\n            if (item.type == \"upload\"){\n              item['props'] = {\n                uploadType: 'image',\n                action: '/proxy/school/multipartFile/upload',\n                data : {\n                  \"path\": \"applet\"\n                },\n                onSuccess(res, file){\n                  let url = \"\";\n                  if (res.data.url != \"\"){\n                    // let urlHttps = res.data.url.indexOf(\"https\");\n                    // let urlHttp = res.data.url.indexOf(\"http\");\n                    // if (urlHttps == -1 || urlHttp == -1){\n                    //   url = \"http:\" + res.data.url\n                    // }else {\n                    //   url = res.data.url\n                    // }\n                    if (res.data.url.indexOf(\"files\") > -1) {\n                      let url1 = res.data.url.split(\"files\")[0];\n                      let url2 = res.data.url.split(\"files\")[1];\n\n                      url = \"https://campus.9451.com:28090/files/\" + url2;\n                    }\n\n                  }\n                  file.url = url\n                  console.log(url)\n                }\n              }\n            }\n          }\n        });\n        return obj;\n      }\n    },\n    serverSubBlock(){\n      this.fApi.submit((formData, fApi)=>{\n        let url = \"\";\n        let ruleList = [];\n        if (this.auditSelUser.length == 0 && this.customUserStatus == true){\n          Toast(this.$t(\"请选择审批人！\"));\n          return;\n        };\n        let params = {\n          appletFormId: this.$route.query.id,\n          userId: this.loginUserId,\n          //applyContent: JSON.stringify(formData),\n          customHandleUserIds: JSON.stringify(this.auditSelUser),\n        }\n\n        let rule = fApi.rule;\n        let ruleObjList =  this.setRuleChild(rule, ruleList);\n        params['applyContent'] = JSON.stringify(ruleObjList);\n\n        url = common.server_form_add;\n        params = this.$qs.stringify(params);\n        this.btnLoading = true;\n        this.$axios.post(url, params, {loading: false}).then(res => {\n          if (res.data.code == 200){\n            Toast(res.data.desc);\n          }else {\n            Toast(res.data.desc);\n          }\n          this.btnLoading = false;\n        });\n      });\n    },\n    returnBlock(){\n      let page = this.$route.query.page ? this.$route.query.page : '/app/appIndex';\n      this.$router.push({\n        path: page,\n        query: {\n          id: this.$route.query.id,\n          activeType: this.$route.query.activeType,\n          userType: this.loginUserAppType,\n          navH: this.navHeight,\n          appType: this.globalAppShow,\n          sessionId: this.$route.query.sessionId\n        }\n      });\n    },\n    setRuleChild(rule, ruleList){\n      let obj = {};\n      for (let i = 0; i < rule.length; i++){\n        if (rule[i]['children'] && rule[i]['children'].length > 0){\n          this.setRuleChild(rule[i]['children'], ruleList);\n          continue;\n        }else {\n          if (rule[i].field){\n            obj = {\n              field: rule[i].field,\n              title: rule[i].title,\n              type: rule[i].type,\n              value: rule[i].value\n            }\n            ruleList.push(obj);\n          }\n        }\n      }\n      return ruleList;\n    }\n  }\n}\n","import mod from \"-!../../node_modules/babel-loader/lib/index.js??ref--2-0!../../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./appServerForm.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js??ref--2-0!../../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./appServerForm.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./appServerForm.vue?vue&type=template&id=5e846832&scoped=true&\"\nimport script from \"./appServerForm.vue?vue&type=script&lang=js&\"\nexport * from \"./appServerForm.vue?vue&type=script&lang=js&\"\nfunction injectStyles (context) {\n  \n  var style0 = require(\"./appServerForm.vue?vue&type=style&index=0&id=5e846832&scoped=true&lang=css&\")\nif (style0.__inject__) style0.__inject__(context)\n\n}\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  \"5e846832\",\n  \"3149f400\"\n  \n)\n\nexport default component.exports"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACVA;AAAA;AAAA;AAAA;AAAA;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACNA;AACA;AACA;;;;;;;;;;;;;;;;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAdA;AAgBA;AACA;AAAA;AACA;AAGA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AADA;AAGA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AA3BA;AA4BA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AAJA;AAOA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAFA;AAWA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAxJA;AA9BA;;ACzFA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}